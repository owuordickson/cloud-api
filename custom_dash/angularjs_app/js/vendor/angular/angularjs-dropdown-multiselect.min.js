"use strict";var directiveModule=angular.module("angularjs-dropdown-multiselect",[]);directiveModule.directive("ngDropdownMultiselect",["$filter","$document","$compile",function($filter,$document){return{restrict:"AE",scope:{selectedModel:"=",options:"=",extraSettings:"="},template:function(element,attrs){var checkboxes=attrs.checkboxes?!0:!1,template='<div class="multiselect-parent btn-group dropdown-multiselect" data-ng-class="{open: open}">';template+='<button type="button" class="btn btn-default dropdown-toggle" ng-click="toggleDropdown()">{{getButtonText()}}<span class="caret"></span></button>',template+='<ul class="dropdown-menu dropdown-menu-form">',template+='<li><a data-ng-click="selectAll()"><span class="glyphicon glyphicon-ok"></span>  Check All</a>',template+='<li><a data-ng-click="deselectAll();"><span class="glyphicon glyphicon-remove"></span>  Uncheck All</a></li>',template+='<li class="divider"></li>',template+=checkboxes?'<li data-ng-repeat="option in options"><a ng-click="setSelectedItem(getPropertyForObject(option,settings.idProp))"><div class="checkbox"><label><input class="checkboxInput" type="checkbox" ng-click="checkboxClick($event, getPropertyForObject(option,settings.idProp))" ng-checked="isChecked(getPropertyForObject(option,settings.idProp))" /> {{getPropertyForObject(option, settings.displayProp)}}</label></div></a></li>':'<li data-ng-repeat="option in options"><a ng-click="setSelectedItem(getPropertyForObject(option,settings.idProp))"><span data-ng-class="{\'glyphicon glyphicon-ok\': isChecked(getPropertyForObject(option,settings.idProp))}"></span> {{getPropertyForObject(option, settings.displayProp)}}</a></li>',template+="</ul>",template+="</div>",element.html(template)},link:function($scope){function getFindObj(id){var findObj={};return""===$scope.settings.externalIdProp?findObj[$scope.settings.idProp]=id:findObj[$scope.settings.externalIdProp]=id,findObj}$scope.toggleDropdown=function(){$scope.open=!$scope.open},$scope.checkboxClick=function($event,id){$scope.setSelectedItem(id),$event.stopImmediatePropagation()},$scope.settings={dynamicTitle:!0,defaultText:"Select",closeOnBlur:!0,displayProp:"label",idProp:"id",externalIdProp:"id"},angular.extend($scope.settings,$scope.extraSettings||[]),$scope.settings.closeOnBlur&&$document.on("click",function(e){for(var target=e.target.parentElement,parentFound=!1;angular.isDefined(target)&&null!==target&&!parentFound;)_.contains(target.classList,"multiselect-parent")&&!parentFound&&(parentFound=!0),target=target.parentElement;parentFound||$scope.$apply(function(){$scope.open=!1})}),$scope.getButtonText=function(){if($scope.settings.dynamicTitle){var totalSelected=angular.isDefined($scope.selectedModel)?$scope.selectedModel.length:0;return 0===totalSelected?$scope.settings.defaultText:totalSelected+" selected"}return $scope.settings.defaultText},$scope.getPropertyForObject=function(object,property){return object.hasOwnProperty(property)?object[property]:""},$scope.selectAll=function(){$scope.deselectAll(),angular.forEach($scope.options,function(value){$scope.setSelectedItem(value[$scope.settings.idProp],!0)})},$scope.deselectAll=function(){$scope.selectedModel=[]},$scope.setSelectedItem=function(id,dontRemove){dontRemove=dontRemove||!1;var findObj=getFindObj(id),exists=-1!==_.findIndex($scope.selectedModel,findObj);if(!dontRemove&&exists)$scope.selectedModel.splice(_.findIndex($scope.selectedModel,findObj),1);else if(!exists)if(""===$scope.settings.externalIdProp){var fullObjFind=getFindObj(id),fullObj=_.find($scope.options,fullObjFind);$scope.selectedModel.push(fullObj)}else $scope.selectedModel.push(findObj);return!1},$scope.isChecked=function(id){return-1!==_.findIndex($scope.selectedModel,getFindObj(id))?!0:!1}}}}]);